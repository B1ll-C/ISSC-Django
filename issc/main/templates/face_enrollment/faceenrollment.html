{% extends 'base.html' %}

{% block title %} Face Enrollment {% endblock title %}

{% block content %}
{% load static %}

<div class="container text-center">
    <h1 class="mt-4">Face Enrollment</h1>

    <!-- Live Video Feed -->
    <div class="mt-4">
        <h2>Live Video</h2>
        <img id="video_feed" src="{% url 'video_feed' %}" alt="Video Feed" class="img-fluid rounded shadow-lg">
    </div>

    <!-- Start Recording Button -->
    <div class="mt-4">
        <button class="btn btn-primary btn-lg" onclick="startRecording()">Open Camera</button>
    </div>
</div>

<script>
    function startRecording() {
        fetch("{% url 'start_recording' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": getCSRFToken(),
            },
        })
            .then(response => response.json())
            .then(data => {
                if (data.redirect) {
                    window.location.href = data.url;  // Redirect to success page
                } else {
                    alert(data.message);
                    location.reload(); // Reload the page if enrollment failed
                }
            })
            .catch(error => console.error("Error:", error));
    }

    function getCSRFToken() {
        return document.cookie.split('; ').find(row => row.startsWith('csrftoken'))
            ?.split('=')[1];
    }
</script>

{% endblock content %}