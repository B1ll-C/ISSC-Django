{% extends 'base.html' %}

{% block title %} Face Enrollment {% endblock title %}

{% block content %}

<h2>Face Enrollment</h2>

<!-- Live Video Stream -->
<img id="video-stream" src="{% url 'video_feed' %}" width="640px" />

<!-- Capture Button -->
<button id="capture">Capture Face</button>
<p id="status"></p>

<!-- CSRF Token (Hidden) -->
<input type="hidden" id="csrf_token" value="{{ csrf_token }}">

<script>
    // Function to get CSRF token from cookie
    function getCSRFToken() {
        let cookieValue = null;
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.startsWith("csrftoken=")) {
                cookieValue = cookie.substring("csrftoken=".length, cookie.length);
                break;
            }
        }
        return cookieValue;
    }

    document.getElementById("capture").addEventListener("click", function () {
        fetch("{% url 'enroll_face' %}", { 
            method: "POST", 
            headers: {
                "X-CSRFToken": getCSRFToken(),  // Include CSRF token in request
                "Content-Type": "application/json",
            },
            credentials: "same-origin"
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById("status").innerText = data.message;
        })
        .catch(error => console.error("Error:", error));
    });
</script>

{% endblock content %}
