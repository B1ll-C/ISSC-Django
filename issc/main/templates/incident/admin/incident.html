{% extends 'base.html' %}

{% block title %} Incident {% endblock title %}

{% block content %}
    <a href="{% url 'incident_forms' %}" class="createnewbtn">File New Incident</a>

    <!-- Incident Reports Table -->
    <table class="form-table">
        <thead>
            <tr>
                <th colspan="13">Open Cases</th>
            </tr>
            <tr>
                <th>Date Time</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Subject</th>
                <th>Location</th>
                <th>Reported By</th>
                <th>Department</th>
                <th>Phone Number</th>
                <th>Status</th>
                <th>Details</th>
                <th colspan="3">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for data in open_incident %}
            <tr>
                <form method="POST" action="">
                    {% csrf_token %}
                    <td>{{ data.date_joined }}</td>
                    <input type="hidden" name="incident_id" value="{{ data.id }}">
                    <td>{{ data.first_name }}</td>
                    <td>{{ data.last_name }}</td>
                    <td>{{ data.subject }}</td>
                    <td>{{ data.location }}</td>
                    <td>{{ data.reported_by }}</td>
                    <td>{{ data.department }}</td>
                    <td>{{ data.phone_number }}</td>
                    <td>
                        <select class="form-input" name="status" style="width: 140px;" disabled>
                            <option value="open" {% if data.status == 'open' %}selected{% endif %}>Open</option>
                            <option value="pending" {% if data.status == 'pending' %}selected{% endif %}>Pending</option>
                            <option value="closed" {% if data.status == 'closed' %}selected{% endif %}>Closed</option>
                        </select>
                    </td>
                    <td><a href="{% url 'incident_details' data.id %}" style="text-decoration: underline;">Details</a></td>
                    <td><button name="delete" class="form-input form-btn" value="{{ data.id }}" onclick="return confirmDelete();" disabled>DELETE</button></td>
                    <td><button name="update" class="form-input form-btn" value="{{ data.id }}" disabled>UPDATE</button></td>
                </form>
                <td><button onclick="toggleEditFields(this)">TOGGLE</button></td>
            </tr>
            {% empty %} 
            <tr>
                <td colspan="13" style="text-align: center;">No Cases Found</td>
            </tr> 
            {% endfor %}
        </tbody>
    </table>


    <table class="form-table">
        <thead>
            <tr>
                <th colspan="13">Pending Cases</th>
            </tr>
            <tr>
                <th>Date Time</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Subject</th>
                <th>Location</th>
                <th>Reported By</th>
                <th>Department</th>
                <th>Phone Number</th>
                <th>Status</th>
                <th>Details</th>
                <th colspan="3">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for data in pending_incident %}
            <tr>
                <form method="POST" action="">
                    {% csrf_token %}
                    <td>{{ data.date_joined }}</td>
                    <input type="hidden" name="incident_id" value="{{ data.id }}">
                    <td>{{ data.first_name }}</td>
                    <td>{{ data.last_name }}</td>
                    <td>{{ data.subject }}</td>
                    <td>{{ data.location }}</td>
                    <td>{{ data.reported_by }}</td>
                    <td>{{ data.department }}</td>
                    <td>{{ data.phone_number }}</td>
                    <td>
                        <select class="form-input" name="status" style="width: 140px;" disabled>
                            <option value="open" {% if data.status == 'open' %}selected{% endif %}>Open</option>
                            <option value="pending" {% if data.status == 'pending' %}selected{% endif %}>Pending</option>
                            <option value="closed" {% if data.status == 'closed' %}selected{% endif %}>Closed</option>
                        </select>
                    </td>
                    <td><a href="{% url 'incident_details' data.id %}" style="text-decoration: underline;">Details</a></td>
                    <td><button name="delete" class="form-input form-btn" value="{{ data.id }}" onclick="return confirmDelete();" disabled>DELETE</button></td>
                    <td><button name="update" class="form-input form-btn" value="{{ data.id }}" disabled>UPDATE</button></td>
                </form>
                <td><button onclick="toggleEditFields(this)">TOGGLE</button></td>
            </tr>
            {% empty %} 
            <tr>
                <td colspan="13" style="text-align: center;">No Cases Found</td>
            </tr> 
            {% endfor %}
        </tbody>
    </table>

    <table class="form-table">
        <thead>
            <tr>
                <th colspan="13">Closed Cases</th>
            </tr>
            <tr>
                <th>Date Time</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Subject</th>
                <th>Location</th>
                <th>Reported By</th>
                <th>Department</th>
                <th>Phone Number</th>
                <th>Status</th>
                <th>Details</th>
                <th colspan="3">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for data in closed_incident %}
            <tr>
                <form method="POST" action="">
                    {% csrf_token %}
                    <td>{{ data.date_joined }}</td>
                    <input type="hidden" name="incident_id" value="{{ data.id }}">
                    <td>{{ data.first_name }}</td>
                    <td>{{ data.last_name }}</td>
                    <td>{{ data.subject }}</td>
                    <td>{{ data.location }}</td>
                    <td>{{ data.reported_by }}</td>
                    <td>{{ data.department }}</td>
                    <td>{{ data.phone_number }}</td>
                    <td>
                        <select class="form-input" name="status" style="width: 140px;" disabled>
                            <option value="open" {% if data.status == 'open' %}selected{% endif %}>Open</option>
                            <option value="pending" {% if data.status == 'pending' %}selected{% endif %}>Pending</option>
                            <option value="closed" {% if data.status == 'closed' %}selected{% endif %}>Closed</option>
                        </select>
                    </td>
                    <td><a href="{% url 'incident_details' data.id %}" style="text-decoration: underline;">Details</a></td>
                    <td><button name="delete" class="form-input form-btn" value="{{ data.id }}" onclick="return confirmDelete();" disabled>DELETE</button></td>
                    <td><button name="update" class="form-input form-btn" value="{{ data.id }}" disabled>UPDATE</button></td>
                </form>
                <td><button onclick="toggleEditFields(this)">TOGGLE</button></td>
            </tr>
            {% empty %} 
            <tr>
                <td colspan="13" style="text-align: center;">No Cases Found</td>
            </tr> 
            {% endfor %}
        </tbody>
    </table>

    <script type="text/javascript">
        function toggleEditFields(button) {
            const row = button.closest('tr'); // Get the closest row of the clicked button
            const inputs = row.querySelectorAll('.form-input'); // Select all input fields in the row
            
            inputs.forEach(input => {
                input.disabled = !input.disabled;
                input.style.cursor = input.disabled ? "not-allowed" : "auto";
            });
        }

        function confirmDelete() {
            return confirm('Do you really want to delete this user?');
        }
    </script>
{% endblock content %}
