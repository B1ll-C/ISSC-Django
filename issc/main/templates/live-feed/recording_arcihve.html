{% extends 'base.html' %}

{% block title %} Recording Archive {% endblock title %}

{% block content %}

{% load static %} 

<h2>Available Recordings</h2>
<a href="{% url 'reset_recordings' %}">reset</a>
{% for cam_id, years in categorized_recordings.items %}
    <h3>Camera {{ cam_id }}</h3>
    <table border="1">
        <thead>
            <tr>
                <th>Year</th>
                <th>Month</th>
                <th>Day</th>
                <th>Recordings</th>
            </tr>
        </thead>
        <tbody>
            {% for year, months in years.items %}
                {% for month, days in months.items %}
                    {% for day, files in days.items %}
                        <tr>
                            <td>{{ year }}</td>
                            <td>{{ month }}</td>
                            <td>{{ day }}</td>
                            <td>
                                <ul>
                                    {% for file in files %}
                                        <li>
                                            <a href="javascript:void(0);" onclick="showPreview('{{ file }}')">{{ file }}</a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </td>
                        </tr>
                    {% endfor %}
                {% endfor %}
            {% endfor %}
        </tbody>
    </table>
    <br>
{% endfor %}

<!-- Preview Sidebar -->
<div id="previewSidebar" style="position: fixed; top: 0; right: 0; width: 300px; height: 100%; background-color: rgba(0, 0, 0, 0.8); color: white; display: none; padding: 20px;">
    <h3>Video Preview</h3>
    <video id="videoPreview" width="100%" controls muted>
        <source id="videoSource" src="" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    <button onclick="closePreview()" style="margin-top: 10px; padding: 10px; background-color: #f44336; color: white; border: none;">Close Preview</button>
</div>

<script>
    // Function to show the preview in the sidebar
    function showPreview(fileName) {
        var videoSource = document.getElementById('videoSource');
        var videoPreview = document.getElementById('videoPreview');
        var previewSidebar = document.getElementById('previewSidebar');

        // Update the video source
        videoSource.src = "/recordings/" + fileName;  // Use the correct MEDIA_URL path

        videoPreview.load();  // Reload the video with the new source

        // Show the sidebar
        previewSidebar.style.display = 'block';
    }

    // Function to close the preview sidebar
    function closePreview() {
        var previewSidebar = document.getElementById('previewSidebar');
        previewSidebar.style.display = 'none';
    }
</script>


{% endblock content %}
